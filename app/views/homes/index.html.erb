<div class="book">
  <!-- 左ページ -->
  <div class="page left-page">
    <div class="tabs">
      <button class="tab active"><p class="date white-text"><%= Date.today.strftime('%Y/%m/%d') %></p></button>
      <%= link_to new_income_path do %><button class="tab">収入入力</button><% end %>
      <button class="tab">支出入力</button>
      <button class="tab">アルバム</button>
      <button class="tab">分析</button>
      <button class="tab">日記</button>
    </div>
    <div class="tab-content">
    <div id="calendar-selects">
     <h2><%= form_with url: root_path, method: :get, local: true do %>
         <%= select_tag :year, options_for_select((2020..2100).to_a, @date.year) %>
         <%= select_tag :month, options_for_select((1..12).to_a, @date.month) %>
         <%= submit_tag "表示" %>
           <% end %></h2>
     </div>
      <!-- カレンダー表示 -->
  <div class="calendar-wrapper">
    <%= month_calendar start_date: @date do |date| %>
      <div>
        <%= date.day %>
        <% if @grouped_incomes[date] %>
          <% total_income = @grouped_incomes[date].sum(&:amount) %>
          <div class="income">+<%= number_with_delimiter(total_income) %>円</div>

          <% total_minutes = @grouped_incomes[date].sum { |i| i.labor_time || 0 } %>
          <% if total_minutes > 0 %>
            <% hours = total_minutes / 60 %>
            <% minutes = total_minutes % 60 %>
            <% total_hours = hours + minutes / 60.0 %>
            <div class="labor">🕒 <%= total_hours.round(2) %>h</div>
          <% end %>
        <% end %>
      </div>
    <% end %>
  </div>
  </div>
  </div>


  <!-- 右ページ -->
  <div class="page">
     <h2><%= @date.strftime("%Y年%m月") %>の家計簿</h2>
  <!-- 今月の収支 -->
  <div class="show-box ">
  <div class="income-box">
    <h3>収入</h3>
    <% if @incomes.any? %>
      <ul>
        <% @incomes.each do |income| %>
          <li><%= income.date.strftime("%m/%d") %>：<%= income.category_income&.name || "カテゴリ" %> / ¥<%= number_with_delimiter(income.amount) %></li>
        <% end %>
      </ul>
    <% else %>
      <p>この月の収入はありません</p>
    <% end %>
  </div>

  <div class="income-box">
    <h3>支出</h3>
    <% if @expenses && @expenses.any? %>
      <ul>
        <% @expenses.each do |expense| %>
          <li><%= expense.date.strftime("%m/%d") %>：<%= expense.name || "カテゴリ" %> / ¥<%= number_with_delimiter(expense.amount) %></li>
        <% end %>
      </ul>
    <% else %>
      <p>この月の支出はありません</p>
    <% end %>
  </div>
  </div>

  
  </div>
</div>