<!-- カテゴリ追加モーダル -->
<div id="income-category-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content">

    <!-- フォーム切り替えボタン -->
    <div class="form-toggle-buttons">
      <button type="button" id="show-income-add-form" class="form-button">＋カテゴリ追加</button>
      <button type="button" id="show-income-edit-form" class="form-button edit">✎ カテゴリ編集</button>
      <button type="button" id="show-income-delete-form" class="form-button delete">− カテゴリ削除</button>
    </div>

    <!-- カテゴリ追加フォーム -->
    <div id="income-add-form" class="category-form-section">
      <%= form_with model: @category_income, url: category_incomes_path, local: true, data: { turbo: false } do |f| %>
        <%= hidden_field_tag :from_modal, true %>
        <h4>カテゴリ名を追加</h4>
        <div class="form-group">
          <%= f.text_field :name, placeholder: "カテゴリ名を入力", class: "form-control" %>
        </div>
        <div class="form-group">
          <%= f.submit "追加", class: "form-submit" %>
        </div>
      <% end %>
    </div>

   <!-- 編集フォーム -->
<div id="income-edit-form" class="category-form-section" style="display: none;">
  <h4>カテゴリ名を変更</h4>
  <% system_categories = current_user.category_incomes.where(user_id: nil) %>
  <% user_categories = current_user.category_incomes.where.not(user_id: nil) %>

  <%= form_with url: update_selected_category_incomes_path, method: :patch, local: true do %>
    <div class="form-group">
      <%= label_tag :category_id, "編集したいカテゴリ" %>
      <%= select_tag :category_id,
            grouped_options_for_select({
              '初期カテゴリ（変更不可）' => system_categories.map { |c| [c.name, c.id] },
              'あなたのカテゴリ' => user_categories.map { |c| [c.name, c.id] }
            }),
            prompt: "カテゴリを選択", class: "form-control" %>
    </div>
    <div class="form-group">
      <%= label_tag :new_name, "新しいカテゴリ名" %>
      <%= text_field_tag :new_name, "", class: "form-control", placeholder: "新しい名前を入力" %>
    </div>
    <div class="form-group">
      <%= submit_tag "更新", class: "form-submit" %>
    </div>
  <% end %>
</div>


  <!-- 削除フォーム -->
<div id="income-delete-form" class="category-form-section" style="display: none;">
  <h4>カテゴリを選んで削除</h4>
  <% system_categories = current_user.category_incomes.where(user_id: nil) %>
  <% user_categories = current_user.category_incomes.where.not(user_id: nil) %>

  <%= form_with url: delete_selected_category_incomes_path, method: :delete, local: true do %>
    <div class="form-group">
      <%= label_tag :category_id, "削除したいカテゴリ" %>
      <%= select_tag :category_id,
            grouped_options_for_select({
              '初期カテゴリ（削除不可）' => system_categories.map { |c| [c.name, c.id] },
              'あなたのカテゴリ' => user_categories.map { |c| [c.name, c.id] }
            }),
            prompt: "カテゴリを選択", class: "form-control" %>
    </div>
    <div class="form-group">
      <%= submit_tag "削除", class: "form-submit", data: { confirm: "本当に削除しますか？" } %>
    </div>
  <% end %>
</div>


    <!-- 最後に閉じるボタン -->
    <div class="form-close-button">
      <button type="button" id="close-income-category-modal" class="form-button">閉じる</button>
    </div>

  </div>
</div>



<div id="worktime-modal" class="modal-overlay" style="display: none;">
  <div class="modal-content-work">
    
    <%= form_with model: @work_time, url: work_times_path, local: true, data: { turbo: false } do |f| %>
      <%= hidden_field_tag :from_modal, true %>

      <div class="form-group">
        <%= f.label :date, "日付" %><br>
        <%= f.date_field :date, value: Date.today, class: "form-control" %>
      </div>

      <div class="form-group">
        <%= f.label :category_work_time_id, "カテゴリ" %><br>
        <%= f.select :category_work_time_id,
        @category_work_times.map { |c| [c.name, c.id] },
       { prompt: "選択してください" },
       class: "form-control" %>
        <button type="button" id="show-worktime-category-form" class="form-button">＋カテゴリ追加</button>
      </div>
    
      <div class="form-group">
        <%= label_tag :labor_hour, "労働時間（時）" %>
        <%= select_tag :labor_hour, options_for_select((0..24).to_a.map { |h| ["#{h}時間", h] }), class: "form-control-inline" %>
      </div>

      <div class="form-group">
        <%= label_tag :labor_minute, "労働時間（分）" %>
        <%= select_tag :labor_minute, options_for_select([0, 15, 30, 45].map { |m| ["#{m}分", m] }), class: "form-control-inline" %>
      </div>

      <div class="form-group">
        <%= f.label :report, "作業日報（任意）" %><br>
        <%= f.text_area :report, class: "form-control", placeholder: "作業内容など" %>
      </div>

      <div class="form-group">
        <%= f.submit "登録", class: "form-submit" %>
      </div>
    <% end %>

    <button id="close-worktime-modal" class="form-button">閉じる</button>
  </div>


  <%= render 'shared/worktime_category_modal' %>
</div>


<% if flash[:alert] %>
  <div class="error-messages">
    <ul>
      <li><%= flash[:alert] %></li>
    </ul>
  </div>
<% end %>

    <div class="book">
  <!-- 左ページ -->
  <div class="page left-page"> 
   
  
   <%= render 'shared/book_style_layout' %>


    <div class="tab-content"> 
      <h2>収入登録</h2>
      <div class="income-main">
        <div class="income-input">
        
          <%= form_with model: @income, local: true, data: { turbo: false } do |f| %>
            <div class="form-group">
              <%= f.label :date, "日付" %><br>
              <%= f.date_field :date, value: Date.today, class: "form-control" %>
            </div>

            <div class="form-group">
              <%= f.label :amount, "金額（円）" %><br>
              <%= f.number_field :amount, class: "form-control" %>
            </div>

            <div class="form-group category-wrapper">
              <%= f.label :category_income_id, "カテゴリ" %><br>
             <%= f.select :category_income_id,
             CategoryIncome.where(user_id: nil).or(CategoryIncome.where(user_id: current_user.id))
              .map { |c| [c.name, c.id] },
             { prompt: "選択してください" },
               class: "form-control" %><br>
            <button type="button" id="show-category-form" class="form-button">＋カテゴリ追加</button>
            </div>
            <div class="title-font-income">労働時間(任意)</div>
            <div class="form-group">
            <button type="button" id="show-worktime-form" class="form-button">＋労働時間の登録</button>
            </div>
            <div class="form-group">
              <%= f.label :memo, "メモ（任意）" %><br>
              <%= f.text_area :memo, class: "form-control" %>
            </div>

            <div class="form-group">
              <%= f.submit "登録する", class: "form-submit" %>
            </div>
          <% end %>  
          <div class="form-group">
          <%= link_to "戻る", root_path, class: "form-control", role: "button" %>
          </div>
        </div>
      </div>
    </div>



  </div>

  <!-- 右ページ -->
  <div class="page">
    <h2>Information</h2>

<% if @category_income && @category_income.errors.any? %>
  <div class="error-messages">
    <ul>
      <% @category_income.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<% if @category_work_time && @category_work_time.errors.any? %>
  <div class="error-messages">
    <ul>
      <% @category_work_time.errors.full_messages.each do |msg| %>
        <li><%= msg %></li>
      <% end %>
    </ul>
  </div>
<% end %>

 <% if @work_time && @work_time.errors.any? %>
    <div class="error-messages">
      <ul>
        <% @work_time.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

<% if @income && @income.errors.any? %>
    <div class="error-messages">
      <ul>
        <% @income.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

    <ul>
     <li><span class="info-title">日付</span>収入のあった日を選択してください。</li>
  <li><span class="info-title">金額</span>収入を入力してください。</li>
  <li><span class="info-title">カテゴリ</span>収入のカテゴリを選択してください。</li>
  <li><span class="info-title">カテゴリ追加</span>クリックすると入力欄が表示されます。</li>
  <li>5つまで自由にカテゴリを追加することができます。</li>
  <li><span class="info-title">労働時間の登録</span>労働時間を記録できます。</li>
  <li>24時間以上の時間を入力したい場合は、左の労働時間入力タブから入力できます。</li>
  <li><span class="info-title">入力方法</span>日付、金額、カテゴリは未入力だと登録できません。</li>
    </ul>
  </div>
</div>

 


